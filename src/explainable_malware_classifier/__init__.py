from collections import defaultdict

import pandas as pd

def get_info_about_dataset(path: str):
    print(path)
    df = pd.read_csv(path)
    print("Number of rows: " + str(len(df)))
    duplicate_api_counter = 0
    mal_classes_count_map = defaultdict(lambda: 0)
    mal_classes_duplicates_map = defaultdict(lambda: 0)
    unique_api_calls = set()
    for idx, row in df.iterrows():
        mal_classes_count_map[row["class"]] += 1
        api_calls: list[str] = row["api"].strip().split(",")
        unique_api_calls.update(api_calls)
        if len(api_calls) > len(set(api_calls)):
            duplicate_api_counter += 1
            mal_classes_duplicates_map[row["class"]] += 1
    print(f"Malware classes and their counts: {dict(mal_classes_count_map)}")
    print(f"Malware classes and number of rows with repeating API calls: {dict(mal_classes_duplicates_map)}")
    print(f"Number of rows with repeating API calls: {duplicate_api_counter}")
    print(f"Number of unique API calls: {len(unique_api_calls)}")


if __name__ == '__main__':
    get_info_about_dataset("datasets/VirusShare.csv")
    print()
    get_info_about_dataset("datasets/VirusSample.csv")